"use strict";var express=require("express"),app=express(),bcrypt=require("bcrypt"),_=require("underscore"),Usuario=require("../models/usuario");app.get("/usuario",function(r,s){var o=Number(r.query.desde)||0,e=Number(r.query.limite)||5,i={estado:!0};Usuario.find(i,"nombre email role estado google img").skip(o).limit(e).exec(function(r,e){if(r)return s.status(400).json({ok:!1,err:r});Usuario.count(i,function(r,o){s.json({ok:!0,usuarios:e,cuantos:o})})})}),app.post("/usuario",function(r,e){var o=r.body;new Usuario({nombre:o.nombre,email:o.email,password:bcrypt.hashSync(o.password,10),role:o.role}).save(function(r,o){if(r)return e.status(400).json({ok:!1,err:r});e.json({ok:!0,usuario:o})})}),app.put("/usuario/:identificador",function(r,e){var o=r.params.identificador,s=_.pick(r.body,["nombre","email","img","role","estado"]);Usuario.findByIdAndUpdate(o,s,{new:!0,runValidators:!0},function(r,o){if(r)return e.status(400).json({ok:!1,err:r});e.json({ok:!0,usuario:o})})}),app.delete("/usuario/:id",function(r,e){var o=r.params.id;Usuario.findByIdAndUpdate(o,{estado:!1},{new:!0},function(r,o){return r?e.status(400).json({ok:!1,err:r}):o?void e.json({ok:!0,usuario:o}):e.status(400).json({ok:!1,err:{message:"Usuario no encontrado"}})})}),module.exports=app;